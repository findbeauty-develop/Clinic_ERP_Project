generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client-backend"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Product {
  id                   String    @id @default(uuid())
  tenant_id            String
  name                 String
  barcode              String?
  created_at           DateTime  @default(now())
  updated_at           DateTime?
  brand                String
  category             String
  current_stock        Int       @default(0)
  inbound_qty          Int?      // Original qty from first inbound (immutable)
  image_url            String?
  is_active            Boolean   @default(true)
  min_stock            Int       @default(0)
  status               String    @default("활성")
  unit                 String?
  purchase_price       Int?
  sale_price           Int?
  capacity_per_product Float?
  capacity_unit        String?
  usage_capacity       Float?
  storage              String?

  // Product-level expiry defaults (yangi fieldlar)
  expiry_months Int? // 유통기한 기간 (default for all batches)
  expiry_unit   String? // 유통기한 단위 ("months" or "days")
  expiry_date   DateTime? // 유효기간 (Product-level expiry date for display purposes)
  alert_days    String? // 알림 일수 (유효기간 임박 alert)
  inbound_manager String? // 입고 담당자 (Product-level manager)

  // Packaging unit conversion
  has_different_packaging_quantity Boolean @default(false) // 포장 단위 내 제품 수량이 다른 경우
  packaging_from_quantity          Int? // 포장 단위 수량 (예: 1)
  packaging_from_unit              String? // 포장 단위 (예: "box")
  packaging_to_quantity            Int? // 제품 수량 (예: 2)
  packaging_to_unit                String? // 제품 단위 (예: "ea")

  // Relations
  batches          Batch[]
  orderItems       OrderItem[]
  outbounds        Outbound[]
  packageItems     PackageItem[]
  packageOutbounds PackageOutbound[]
  returns          Return[]
  returnPolicy     ReturnPolicy?
  supplierProducts SupplierProduct[] // DEPRECATED: Will be removed after migration
  productSupplier  ProductSupplier? // NEW: 1:1 mapping to supplier (per tenant)

  @@index([tenant_id])
  @@index([tenant_id, name])
  @@index([tenant_id, barcode])
}

model Clinic {
  id                    String    @id @default(uuid())
  tenant_id             String
  name                  String
  english_name          String
  category              String
  location              String
  phone_number          String?
  medical_subjects      String
  license_type          String
  license_number        String
  document_issue_number String
  document_image_urls   String[]  @default([])
  created_at            DateTime  @default(now())
  created_by            String?
  updated_at            DateTime?
  updated_by            String?
  doctor_name           String?
  open_date             DateTime?
  logo_url              String?
  // Privacy and disclosure settings
  allow_company_search  Boolean   @default(false) // 기업 검색 허용
  allow_info_disclosure Boolean   @default(false) // 병의원 정보 공개

  @@index([tenant_id])
}

model Member {
  id                   String         @id @default(uuid())
  tenant_id            String
  member_id            String         @unique
  role                 String
  password_hash        String
  clinic_name          String
  created_at           DateTime       @default(now())
  created_by           String?
  updated_at           DateTime?
  updated_by           String?
  full_name            String?
  phone_number         String?
  id_card_number       String?
  address              String?
  must_change_password Boolean        @default(false)
  refreshTokens        RefreshToken[]

  @@index([tenant_id])
}

model RefreshToken {
  id         String   @id @default(uuid())
  member_id String
  token      String   @unique
  expires_at DateTime
  created_at DateTime @default(now())
  revoked    Boolean  @default(false)
  revoked_at DateTime?
  member     Member   @relation(fields: [member_id], references: [id], onDelete: Cascade)

  @@index([member_id])
  @@index([token])
  @@index([expires_at])
}

model ReturnPolicy {
  id             String    @id @default(uuid())
  tenant_id      String
  product_id     String    @unique
  is_returnable  Boolean   @default(false)
  refund_amount  Float     @default(0)
  return_storage String?
  note           String?
  created_at     DateTime  @default(now())
  updated_at     DateTime?
  product        Product   @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
}

model Batch {
  id               String      @id @default(uuid())
  tenant_id        String
  product_id       String
  batch_no         String
  storage          String?
  purchase_price   Int?
  sale_price       Int?
  manufacture_date DateTime?
  expiry_date      DateTime?
  expiry_months    Int?
  qty              Int
  inbound_qty      Int?         // Original qty when batch was created (immutable)
  unit             String?      // Unit from product (e.g., EA, BOX, etc.)
  min_stock        Int?         // Minimum stock from product (immutable)
  alert_days       String?
  used_count       Int         @default(0) // Ishlatilgan mahsulotlar soni (usageCapacity asosida)
  available_quantity Int?      // Available quantity: (inbound_qty * capacity_per_product) - used_count (auto-calculated)
  created_at       DateTime    @default(now())
  updated_at       DateTime?
  expiry_unit      String?
  inbound_manager  String?
  product          Product     @relation(fields: [product_id], references: [id], onDelete: Cascade)
  orderItems       OrderItem[]
  outbounds        Outbound[]
  packageOutbounds PackageOutbound[]
  returns          Return[]

  @@index([tenant_id])
  @@index([product_id])
  @@index([tenant_id, product_id])
}

// DEPRECATED: Will be removed after migration to ProductSupplier
model SupplierProduct {
  id                  String    @id @default(uuid())
  tenant_id           String
  product_id          String
  supplier_id         String?
  supplier_manager_id String? // SupplierManager ID (if supplier is registered on platform)
  purchase_price      Int?
  moq                 Int?
  lead_time_days      Int?
  note                String?
  created_at          DateTime  @default(now())
  updated_at          DateTime?
  contact_name        String?
  contact_phone       String?
  contact_email       String?
  supplier_tenant_id  String?
  company_name        String?
  product             Product   @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
  @@index([product_id])
  @@index([supplier_id])
  @@index([supplier_manager_id])
  @@index([supplier_tenant_id])
  @@index([tenant_id, product_id])
}

// NEW: Product ↔ Supplier mapping (1:1 per tenant)
model ProductSupplier {
  id                         String @id @default(uuid())
  tenant_id                  String
  product_id                 String @unique // Unique per tenant (enforced by @@unique([tenant_id, product_id]))
  clinic_supplier_manager_id String // ClinicSupplierManager ID (never NULL)

  // Product-specific supplier overrides
  purchase_price Int? // Overrides Product.purchase_price if set
  moq            Int? // Minimum order quantity
  lead_time_days Int? // Lead time in days
  note           String? // Product-specific supplier note

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  product               Product               @relation(fields: [product_id], references: [id], onDelete: Cascade)
  clinicSupplierManager ClinicSupplierManager @relation(fields: [clinic_supplier_manager_id], references: [id], onDelete: Cascade)

  // Constraints: 1 product = 1 supplier per tenant
  @@unique([tenant_id, product_id])
  @@index([tenant_id])
  @@index([product_id])
  @@index([clinic_supplier_manager_id])
  @@index([tenant_id, clinic_supplier_manager_id])
}

model Outbound {
  id            String    @id @default(uuid())
  tenant_id     String
  product_id    String
  batch_id      String
  batch_no      String
  outbound_qty  Int
  outbound_date DateTime  @default(now())
  manager_name  String
  patient_name  String?
  chart_number  String?
  memo          String?
  created_at    DateTime  @default(now())
  updated_at    DateTime?
  created_by    String?
  is_damaged    Boolean   @default(false)
  is_defective  Boolean   @default(false)
  outbound_type String    @default("제품")
  package_id    String?
  batch         Batch     @relation(fields: [batch_id], references: [id], onDelete: Cascade)
  product       Product   @relation(fields: [product_id], references: [id], onDelete: Cascade)
  returns       Return[]

  @@index([tenant_id])
  @@index([product_id])
  @@index([batch_id])
  @@index([outbound_date])
  @@index([outbound_type])
  @@index([tenant_id, outbound_date])
}

model PackageOutbound {
  id            String    @id @default(uuid())
  tenant_id     String
  package_id    String
  package_name  String?   // Denormalized package name for faster access
  product_id    String
  batch_id      String
  package_qty   Int       // 패키지 수량 (nechta package outbound qilingan)
  outbound_date DateTime  @default(now())
  manager_name  String
  chart_number  String?
  memo          String?
  created_at    DateTime  @default(now())
  is_damaged    Boolean   @default(false)
  is_defective  Boolean   @default(false)
  
  // Relations
  package Package @relation(fields: [package_id], references: [id], onDelete: Cascade)
  product Product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  batch   Batch   @relation(fields: [batch_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
  @@index([package_id])
  @@index([product_id])
  @@index([batch_id])
  @@index([outbound_date])
  @@index([tenant_id, outbound_date])
}

model Package {
  id          String        @id @default(uuid())
  tenant_id   String
  name        String
  description String?
  is_active   Boolean       @default(true)
  created_at  DateTime      @default(now())
  updated_at  DateTime?
  created_by  String?
  updated_by  String?
  items       PackageItem[]
  packageOutbounds PackageOutbound[]

  @@index([tenant_id])
  @@index([tenant_id, is_active])
}

model PackageItem {
  id           String  @id @default(uuid())
  tenant_id    String
  package_id  String
  package_name String? // Denormalized package name for faster access
  product_id  String
  quantity    Int     @default(1)
  order       Int     @default(0)
  package     Package @relation(fields: [package_id], references: [id], onDelete: Cascade)
  product     Product @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@unique([package_id, product_id])
  @@index([tenant_id])
  @@index([package_id])
  @@index([product_id])
}

model PackageReservation {
  id           String    @id @default(uuid())
  tenant_id    String
  package_id   String
  product_id   String
  batch_id     String
  reserved_qty Int
  created_at   DateTime  @default(now())
  updated_at   DateTime?

  @@index([tenant_id])
  @@index([package_id])
  @@index([product_id])
  @@index([batch_id])
  @@index([tenant_id, package_id])
  @@index([tenant_id, product_id])
  @@index([tenant_id, batch_id])
}

model Return {
  id            String    @id @default(uuid())
  tenant_id     String
  product_id    String
  batch_id      String
  outbound_id   String?
  batch_no      String
  supplier_id   String?
  return_no     String? // 반품번호: R + YYYYMMDD + 6 random digits (for supplier communication)
  return_qty    Int
  return_date   DateTime  @default(now())
  refund_amount Float     @default(0)
  total_refund  Float     @default(0)
  manager_name  String
  memo          String?
  created_at    DateTime  @default(now())
  updated_at    DateTime?
  created_by    String?
  batch         Batch     @relation(fields: [batch_id], references: [id], onDelete: Cascade)
  outbound      Outbound? @relation(fields: [outbound_id], references: [id])
  product       Product   @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
  @@index([product_id])
  @@index([batch_id])
  @@index([outbound_id])
  @@index([return_date])
  @@index([tenant_id, return_date])
}

model Order {
  id                     String    @id @default(uuid())
  tenant_id              String
  order_no               String    @unique
  status                 String    @default("draft") // draft, pending, supplier_confirmed, inbound_completed, cancelled
  supplier_id            String?
  total_amount           Float     @default(0)
  order_date             DateTime  @default(now())
  expected_delivery_date DateTime?
  created_by             String?
  approved_by            String?
  memo                   String?
  clinic_manager_name    String? // 클리닉 담당자 이름

  // Supplier confirmation data
  supplier_adjustments Json? // Supplier'ning adjustment ma'lumotlari (qty, price, reasons)
  confirmed_at         DateTime? // Supplier qachon confirm qilgan

  created_at DateTime    @default(now())
  updated_at DateTime?
  items      OrderItem[]

  @@index([tenant_id])
  @@index([supplier_id])
  @@index([status])
  @@index([order_date])
  @@index([tenant_id, status])
  @@index([tenant_id, order_date])
  @@index([tenant_id, status, confirmed_at])
}

model OrderItem {
  id          String    @id @default(uuid())
  tenant_id   String
  order_id    String
  product_id  String
  batch_id    String?
  unit        String? 
  quantity    Int
  unit_price  Int
  total_price Int
  memo        String?
  created_at  DateTime  @default(now())
  updated_at  DateTime?
  batch       Batch?    @relation(fields: [batch_id], references: [id])
  order       Order     @relation(fields: [order_id], references: [id], onDelete: Cascade)
  product     Product   @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
  @@index([order_id])
  @@index([product_id])
  @@index([batch_id])
  @@index([tenant_id, order_id])
}

model OrderDraft {
  id           String   @id @default(uuid())
  tenant_id    String
  session_id   String
  items        Json
  total_amount Float    @default(0)
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())
  expires_at   DateTime

  @@unique([tenant_id, session_id])
  @@index([tenant_id])
  @@index([session_id])
  @@index([expires_at])
}

model OrderReturn {
  id              String    @id @default(uuid())
  tenant_id       String
  order_id        String? // Optional for defective products from outbound
  order_no        String? // Optional for defective products from outbound
  outbound_id     String? // For defective products from outbound
  return_no       String? // 반품번호: B + YYYYMMDD + 6 random digits
  batch_no        String
  product_id      String
  product_name    String
  brand           String?
  return_quantity Int // 미입고수량 (excess/defective qty)
  total_quantity  Int // confirmedQuantity from supplier (for order returns) or outbound qty (for defective)
  unit_price      Int
  return_type     String // "주문|반품", "주문|교환", "불량|반품", "불량|교환"
  status          String    @default("pending") // "pending", "processing", "completed", "rejected"
  memo            String?
  images          String[]  @default([])
  return_manager  String? // 반품 담당자
  supplier_id     String?
  inbound_date    DateTime  @default(now())
  created_at      DateTime  @default(now())
  updated_at      DateTime?

  @@index([tenant_id])
  @@index([order_id])
  @@index([outbound_id])
  @@index([return_no])
  @@index([status])
  @@index([tenant_id, status])
  @@index([return_type])
}

model RejectedOrder {
  id            String    @id @default(uuid())
  tenant_id     String
  order_id      String
  order_no      String
  company_name  String // Supplier company name
  manager_name  String // Supplier manager name
  product_name  String
  product_brand String?
  qty           Int // Rejected quantity
  member_name   String // Member who checked/confirmed the rejection
  created_at    DateTime  @default(now())
  updated_at    DateTime?

  @@index([tenant_id])
  @@index([order_id])
  @@index([order_no])
  @@index([tenant_id, order_id])
}

model Supplier {
  id                 String            @id @default(uuid())
  tenant_id          String            @unique
  company_name       String
  business_number    String            @unique
  company_phone      String?
  company_email      String
  company_address    String?
  product_categories String[]          @default([])
  share_consent      Boolean           @default(false)
  status             String            @default("MANUAL_ONLY")
  created_at         DateTime          @default(now())
  updated_at         DateTime?
  managers           SupplierManager[] @relation("SupplierToManagers")

  @@index([tenant_id])
  @@index([business_number])
  @@index([status])
}

/// Clinic ↔ SupplierManager relationship lifecycle.
/// Tracks trade relationship status (REQUESTED → APPROVED → BLOCKED).
/// Can be traced back to ClinicSupplierManager for audit.
model ClinicSupplierLink {
  id        String @id @default(uuid())
  tenant_id String

  supplier_manager_id String // SupplierManager ID (platform supplier)
  supplierManager     SupplierManager @relation(fields: [supplier_manager_id], references: [id], onDelete: Cascade)

  // Traceability: which ClinicSupplierManager initiated this link (optional)
  clinic_supplier_manager_id String?
  clinicSupplierManager      ClinicSupplierManager? @relation(fields: [clinic_supplier_manager_id], references: [id], onDelete: SetNull)

  // Lifecycle
  status       String    @default("REQUESTED")
  requested_at DateTime  @default(now())
  approved_at  DateTime?
  blocked_at   DateTime?

  memo String? // Supplier tomonidan clinic haqida memo

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@unique([tenant_id, supplier_manager_id])
  @@index([tenant_id])
  @@index([supplier_manager_id])
  @@index([clinic_supplier_manager_id])
  @@index([status])
  @@index([tenant_id, status])
}

/// Manual supplier contact created by clinic.
/// Can be claimed/linked to SupplierManager when supplier registers on platform.
model ClinicSupplierManager {
  id        String @id @default(uuid())
  tenant_id String

  // Company information (denormalized - stored here for manual suppliers)
  company_name    String // Company name (required)
  business_number String? // Business registration number (for claim matching)
  company_phone   String? // Company phone
  company_email   String? // Company email
  company_address String? // Company address

  // Contact person information
  name                  String // Manager/contact name
  phone_number          String // Contact phone (for claim matching)
  email1                String?
  email2                String?
  position              String? // 직함
  certificate_image_url String?

  // Additional info
  responsible_regions  String[] @default([])
  responsible_products String[] @default([])
  memo                 String?

  // Claim/link to platform supplier (optional)
  linked_supplier_manager_id String? // SupplierManager ID (when claimed)
  linkedManager              SupplierManager? @relation("ClaimedBySupplierManager", fields: [linked_supplier_manager_id], references: [id], onDelete: SetNull)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  productSuppliers ProductSupplier[] // Products mapped to this supplier
  clinicLinks      ClinicSupplierLink[] // Trade links created from this contact
  SupplierManager  SupplierManager?

  @@index([tenant_id])
  @@index([tenant_id, phone_number])
  @@index([tenant_id, business_number])
  @@index([linked_supplier_manager_id])
  @@index([phone_number]) // For claim matching
}

model SupplierManager {
  id                    String    @id @default(uuid())
  manager_id            String    @unique
  name                  String
  phone_number          String    @unique
  certificate_image_url String?
  password_hash         String?
  email1                String?
  responsible_products  String[]  @default([])
  status                String    @default("ACTIVE")
  created_at            DateTime  @default(now())
  updated_at            DateTime?
  position              String?
  clinic_manager_id     String?   @unique
  supplier_tenant_id    String
  manager_address       String?
  created_by            String?

  // 알림 설정 (Notification Settings)
  public_contact_name   Boolean @default(false) // 담당자 이름 공개
  allow_hospital_search Boolean @default(false) // 병의원 검색 허용
  receive_kakaotalk     Boolean @default(false) // 카톡 알림 받기
  receive_sms           Boolean @default(false) // 문자(SMS) 알림 받기
  receive_email         Boolean @default(false) // 이메일 알림 받기

  // 회원탈퇴 (Withdrawal)
  withdrawal_reason String? // 회원탈퇴 사유 (optional)

  clinicLinks                 ClinicSupplierLink[]
  clinicManager               ClinicSupplierManager?       @relation(fields: [clinic_manager_id], references: [id])
  claimedClinicContacts       ClinicSupplierManager[]      @relation("ClaimedBySupplierManager") // Claimed manual contacts
  supplierReturnNotifications SupplierReturnNotification[]

  supplier Supplier @relation("SupplierToManagers", fields: [supplier_tenant_id], references: [tenant_id])

  @@index([supplier_tenant_id])
  @@index([manager_id])
  @@index([phone_number])
  @@index([email1])
  @@index([status])
  @@index([clinic_manager_id])
  @@index([created_by])
}

model SupplierReturnNotification {
  id                     String          @id @default(uuid())
  supplier_manager_id    String
  return_id              String
  clinic_tenant_id       String
  clinic_name            String?
  product_id             String
  product_name           String
  product_brand          String
  product_code           String?
  return_qty             Int
  refund_amount_per_item Float
  total_refund           Float
  return_manager_name    String
  return_date            DateTime
  batch_no               String?
  status                 String          @default("PENDING")
  is_read                Boolean         @default(false)
  created_at             DateTime        @default(now())
  updated_at             DateTime?
  accepted_at            DateTime?
  rejected_at            DateTime?
  accepted_quantity      Int?
  unreturned_quantity    Int?
  quantity_change_reason String?
  supplierManager        SupplierManager @relation(fields: [supplier_manager_id], references: [id], onDelete: Cascade)

  @@index([supplier_manager_id])
  @@index([return_id])
  @@index([clinic_tenant_id])
  @@index([status])
  @@index([is_read])
  @@index([supplier_manager_id, status])
  @@index([supplier_manager_id, is_read])
  @@index([created_at])
}

model SupplierOrder {
  id                  String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  supplier_tenant_id  String
  supplier_manager_id String?
  clinic_tenant_id    String?
  clinic_name         String?
  clinic_manager_name String?
  order_no            String              @unique
  status              String              @default("pending")
  total_amount        Int                 @default(0)
  memo                String?
  order_date          DateTime            @default(now()) @db.Timestamptz(6)
  created_at          DateTime            @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?           @db.Timestamptz(6)
  SupplierOrderItem   SupplierOrderItem[]

  @@index([clinic_tenant_id], map: "SupplierOrder_clinic_tenant_idx")
  @@index([order_date])
  @@index([status])
  @@index([supplier_manager_id], map: "SupplierOrder_supplier_manager_idx")
  @@index([supplier_tenant_id], map: "SupplierOrder_supplier_tenant_idx")
}

model SupplierOrderItem {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id      String        @db.Uuid
  product_id    String?
  product_name  String
  brand         String?
  batch_no      String?
  quantity      Int
  unit_price    Int
  total_price   Int
  memo          String?
  created_at    DateTime      @default(now()) @db.Timestamptz(6)
  updated_at    DateTime?     @db.Timestamptz(6)
  SupplierOrder SupplierOrder @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([order_id])
  @@index([product_id])
}

model WarehouseLocation {
  id         String    @id @default(uuid())
  tenant_id  String
  name       String
  category   String? // 수면실, 레이저 실, 창고, 기타
  items      String[]  @default([]) // A 침대, B 침대, etc.
  created_at DateTime  @default(now())
  updated_at DateTime?

  @@unique([tenant_id, name])
  @@index([tenant_id])
  @@index([category])
}

model NewsCache {
  id         String   @id @default(uuid())
  cache_key  String   @unique
  data       String // JSON string
  updated_at DateTime @default(now())
  created_at DateTime @default(now())

  @@index([cache_key])
  @@index([updated_at])
}

model PhoneVerificationCode {
  id           String   @id @default(uuid())
  phone_number String
  code         String
  verified     Boolean  @default(false)
  expires_at   DateTime
  created_at   DateTime @default(now())

  @@index([phone_number, verified])
  @@index([expires_at])
}

// 공급업체 지역 태그 (Supplier Region Tag) - For search/matching
model SupplierRegionTag {
  id         String   @id @default(uuid())
  name       String   @unique
  created_at DateTime @default(now())

  @@index([name])
}

// 공급업체 제품 태그 (Supplier Product Tag) - For search/matching
model SupplierProductTag {
  id         String   @id @default(uuid())
  name       String   @unique
  created_at DateTime @default(now())

  @@index([name])
}

// Clinic → Supplier return request
model SupplierReturnRequest {
  id                  String    @id @default(uuid())
  supplier_tenant_id  String // Which supplier company
  supplier_manager_id String? // Target manager (if any)
  clinic_tenant_id    String // Which clinic sent the return
  clinic_name         String // Denormalized clinic name
  clinic_manager_name String // Denormalized clinic manager name (담당자)
  return_no           String    @unique // 반품번호: B + YYYYMMDD + 6 random digits
  status              String    @default("pending") // pending, processing, completed, rejected
  memo                String? // General memo for the return request
  created_at          DateTime  @default(now())
  updated_at          DateTime?
  confirmed_at        DateTime? // When supplier confirms (요청 확인)
  completed_at        DateTime? // When supplier marks as received (제품 받았음)
  rejected_at         DateTime? // When supplier rejects
  rejected_reason     String? // Rejection reason

  items SupplierReturnItem[]

  @@index([supplier_tenant_id])
  @@index([supplier_manager_id])
  @@index([clinic_tenant_id])
  @@index([return_no])
  @@index([status])
  @@index([created_at])
}

// Clinic → Supplier return request items
model SupplierReturnItem {
  id                String   @id @default(uuid())
  return_request_id String
  product_name      String
  brand             String?
  quantity          Int
  status            String   @default("pending") // pending, processing, completed, rejected
  return_type       String // "주문|반품", "주문|교환", "불량|반품", "불량|교환"
  memo              String? // Item-specific memo
  images            String[] @default([]) // Image URLs
  inbound_date      String // YYYY-MM-DD format
  total_price       Int
  order_no          String? // For 주문 returns
  batch_no          String? // For 불량 returns

  created_at DateTime  @default(now())
  updated_at DateTime?

  returnRequest SupplierReturnRequest @relation(fields: [return_request_id], references: [id], onDelete: Cascade)

  @@index([return_request_id])
}

model ClinicSupportCenter {
  id           String   @id @default(uuid())
  tenant_id    String
  member_name  String   // 이름
  clinic_name  String   // 병의원 (auto-filled from Clinic.name)
  phone_number String   // 연락처
  inquiry      String   // 문의 내용 (max 500 characters)
  created_at   DateTime @default(now())

  @@index([tenant_id])
  @@index([created_at])
  @@index([tenant_id, created_at])
}
