datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Product {
  id            String   @id @default(uuid())
  tenant_id     String?
  name          String
  brand         String
  barcode       String?
  image_url     String?
  category      String
  is_active     Boolean  @default(true)
  current_stock Int      @default(0)
  min_stock     Int      @default(0)
  created_at    DateTime @default(now())
  updated_at    DateTime?

  returnPolicy    ReturnPolicy?
  batches         Batch[]
  supplierProducts SupplierProduct[]
}

model Clinic {
  id                    String    @id @default(uuid())
  tenant_id             String
  name                  String
  english_name          String
  category              String
  location              String
  medical_subjects      String
  description           String?
  license_type          String
  license_number        String
  document_issue_number String
  document_image_urls   String[]  @default([])
  created_at            DateTime  @default(now())
  created_by            String?
  updated_at            DateTime?
  updated_by            String?

  @@index([tenant_id])
}

model Member {
  id            String   @id @default(uuid())
  tenant_id     String
  member_id     String   @unique
  role          String
  password_hash String
  clinic_name   String
  full_name     String?
  phone_number  String?
  id_card_number String?
  address       String?
  created_at    DateTime @default(now())
  created_by    String?
  updated_at    DateTime?
  updated_by    String?

  @@index([tenant_id])
}

model ReturnPolicy {
  id             String   @id @default(uuid())
  tenant_id      String?
  product_id     String   @unique
  is_returnable  Boolean  @default(false)
  refund_amount  Float    @default(0)
  return_storage String?
  note           String?
  created_at     DateTime @default(now())
  updated_at     DateTime?

  product Product @relation(fields: [product_id], references: [id], onDelete: Cascade)
}

model Batch {
  id              String    @id @default(uuid())
  tenant_id       String?
  product_id      String
  batch_no        String
  storage         String?
  purchase_price  Int?
  sale_price      Int?
  manufacture_date DateTime?
  expiry_date     DateTime?
  expiry_months   Int?
  qty             Int
  alert_days      String?
  created_at      DateTime  @default(now())
  updated_at      DateTime?

  product Product @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
  @@index([product_id])
}

model SupplierProduct {
  id              String   @id @default(uuid())
  tenant_id       String?
  product_id      String
  supplier_id     String
  purchase_price  Int?
  moq             Int?
  lead_time_days  Int?
  note            String?
  created_at      DateTime @default(now())
  updated_at      DateTime?

  product Product @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
  @@index([product_id])
  @@index([supplier_id])
}
