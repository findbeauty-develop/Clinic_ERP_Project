datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// 공급업체 (Supplier) - Supplier company information
model Supplier {
  id                String    @id @default(uuid())
  tenant_id         String?   // Optional - for multi-tenant support
  company_name      String
  business_number   String    @unique // 사업자 등록번호
  company_phone     String?
  company_email     String
  company_address   String?
  business_type      String?   // 업태
  business_item      String?   // 종목
  product_categories String[]  @default([]) // 취급 제품 카테고리
  share_consent     Boolean   @default(false) // 회사 정보 공유 동의
  status            String    @default("pending") // pending, approved, rejected
  created_at        DateTime  @default(now())
  updated_at        DateTime?
  
  // Relations
  managers          SupplierManager[]
  
  @@index([tenant_id])
  @@index([business_number])
  @@index([status])
}

// 공급업체 담당자 (Supplier Manager) - Supplier contact person
model SupplierManager {
  id                    String    @id @default(uuid())
  supplier_id           String
  manager_id            String    @unique // 담당자 ID (회사이름+4자리 숫자)
  name                  String
  phone_number          String    @unique
  certificate_image_url String?   // 사업자등록증 이미지 URL
  
  // 계정 정보
  password_hash         String?   // Optional - clinic tomonidan yaratilganda null bo'lishi mumkin
  email1               String?   // Optional - clinic tomonidan yaratilganda null bo'lishi mumkin
  email2               String?
  
  // 담당 정보
  responsible_regions   String[]  @default([]) // 담당 지역
  responsible_products  String[]  @default([]) // 담당 제품
  position              String?   // 직함 (Job Title): 사원, 주임, 대리, 과장, 차장, 부장
  
  // 생성 정보
  created_by            String?   // "clinic" yoki "supplier" - kim yaratganini belgilash
  
  status                String    @default("pending") // pending, approved, rejected, active
  created_at            DateTime  @default(now())
  updated_at            DateTime?
  
  // Relations
  supplier              Supplier  @relation(fields: [supplier_id], references: [id], onDelete: Cascade)
  
  @@index([supplier_id])
  @@index([manager_id])
  @@index([phone_number])
  @@index([email1])
  @@index([status])
  @@index([created_by])
}

// 공급업체 지역 태그 (Supplier Region Tag) - For search/matching
model SupplierRegionTag {
  id        String   @id @default(uuid())
  name      String   @unique
  created_at DateTime @default(now())
  
  @@index([name])
}

// 공급업체 제품 태그 (Supplier Product Tag) - For search/matching
model SupplierProductTag {
  id        String   @id @default(uuid())
  name      String   @unique
  created_at DateTime @default(now())
  
  @@index([name])
}
